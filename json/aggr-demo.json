{
    "name": "aggr-demo-api",
    "config": {
        "type": "REQUEST",
        "method": "POST",
        "path": "/aggr-demo/hotel/rates",
        "dataMapping": {
            "response": {
           		"headers": {
                    "traceId": "step1.requests.request1.response.body.hello"
                },
                "body": {
                    "aaa": "step1.result",
                    "bbb": "step1.requests.request1.response.body.hello",
                    "ccc": "step2.requests.request3.response.body.hello",
                    "step2_request2_response": "step2.requests.request2.response.body"
                }
            }
        },
        "stepConfigs": [{
            "name": "step1",
            "stop": false,
            "dataMapping": {
                "response": {
                    "body": {
                        "rates": "step1.requests.request1.response.body.hello",
                        "roomTypes": "step1.requests.request1.response.body.user"
                    }
                }
            },
            "requests": {
                "request1": {
                    "type": "REQUEST",
                    "config": {
                        "url": "http://localhost:8080/delay?a=cccc&eeee=4444&seconds=1",
                        "method": "GET",
                        "connectTimeout": 1,
                        "readTimeout": 2,
                        "writeTimeout": 2,
                        "fallbackPlan": {
                            "mode": "continue",
                            "fallbackResult": "{\"user\":\"xxxxxxyyyyyyyyyyyyxx\"}"
                        },
                        "dataMapping": {
                            "request": {
		                        "fixedHeaders": {
		                            "a": "b"
		                        },
		                        "fixedParams": {
		                            "a": "b"
		                        },
		                        "fixedBody": {
		
		                        },
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                },
                                "params": {
                                    "bbb": "input.request.body.userId"
                                }
                            },
                            "response": {
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                },
	                            "script": {
	                            	"type": "groovy",
	                            	"source": "",
	                             	"variables": {
	                             		"appid": "1140",
	                             		"token": "859EE0413BC3F88F1F89C162800FB056"
									}
	                            }
                            }
                        }
                    }
                },
                "request2": {
                    "type": "REQUEST",
                    "config": {
                        "url": "http://localhost:8080/json",
                        "method": "GET",
                        "dataMapping": {
                            "request": {
                            	"fixedHeaders": {
		                            "a": "b"
		                        },
		                        "fixedParams": {
		                            "a": "b"
		                        },
		                        "fixedBody": {
		
		                        },
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                },
                                "params": {
                                    "userId": "input.requestBody.userId"
                                }
                            },
                            "response": {
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                }
                            }
                        }
                    }
                }
            }
        },
        {
            "name": "step2",
            "stop": false,
            "dataMapping": {
                "response": {
                    "body": {
                        
                    }
                }
            },
            "requests": {
                "request1": {
                    "type": "REQUEST",
                    "config": {
                        "url": "http://localhost:8080/json",
                        "method": "GET",
                        "dataMapping": {
                            "request": {
                            	"fixedHeaders": {
		                            "a": "b"
		                        },
		                        "fixedParams": {
		                            "a": "b"
		                        },
		                        "fixedBody": {
		
		                        },
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "abc.requestBody22": "step1.requests.request1.response.body"
                                },
                                "params": {
                                    "userId": "input.requestBody.userId"
                                }
                            },
                            "response": {
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                }
                            }
                        }
                    }
                },
                "request2": {
                    "type": "REQUEST",
                    "config": {
                        "url": "http://localhost:8080/json",
                        "method": "GET",
                        "condition": {
                            "type": "groovy",
                            "source": "return \"ABC\".equals(variables.get(\"param1\")) && variables.get(\"param2\") >= 10;",
                            "variables": {
                                "param1": "input step1.requests.request2.response.body.user",
                                "param2": 10
                            }
                        },
                        "dataMapping": {
                            "request": {
                            	"fixedHeaders": {
		                            "a": "b"
		                        },
		                        "fixedParams": {
		                            "a": "b"
		                        },
		                        "fixedBody": {
		
		                        },
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "abc.requestBody22": "step1.requests.request1.response.body"
                                },
                                "params": {
                                    "userId": "input.requestBody.userId"
                                }
                            },
                            "response": {
                                "headers": {
                                    "abc": "step1.requests.request1.headers.xyz"
                                },
                                "body": {
                                    "inn.innId": "step1.requests.request1.response.id"
                                }
                            }
                        }
                    }
                }
            }
        }]
    }
}